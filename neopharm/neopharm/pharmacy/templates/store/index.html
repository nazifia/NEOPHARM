{% extends 'store/base_enhanced.html' %}

{% block title %}Login - NEOPHARM{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center align-items-center" style="min-height: 70vh;">
        <div class="col-xl-4 col-lg-5 col-md-7 col-sm-9">
            <!-- Login Card -->
            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-header bg-white border-0 text-center pb-0 pt-4">
                    <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                        <i class="bi bi-capsule-pill text-primary fs-2"></i>
                    </div>
                    <h3 class="fw-bold mb-1">Welcome to NEOPHARM</h3>
                    <p class="text-muted mb-0 small">Pharmacy Management System</p>
                </div>
                
                <div class="card-body px-4 pb-4">
                    {% if messages %}
                        {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} mb-3 py-2 small">
                            <i class="bi {% if message.tags == 'success' %}bi-check-circle-fill{% elif message.tags == 'danger' %}bi-exclamation-triangle-fill{% else %}bi-info-circle-fill{% endif %} me-1"></i>
                            {{ message }}
                        </div>
                        {% endfor %}
                    {% endif %}
                    
                    <form method="POST" action="{% url 'store:index' %}" id="loginForm">
                        {% csrf_token %}
                        {% if request.GET.next %}
                            <input type="hidden" name="next" value="{{ request.GET.next }}">
                        {% endif %}
                        
                        <div class="mb-3">
                            <label for="mobile" class="form-label fw-semibold small text-uppercase text-muted">
                                <i class="bi bi-phone me-1"></i> Mobile Number
                            </label>
                            <input type="text" 
                                   class="form-control form-control-lg" 
                                   id="mobile" 
                                   name="mobile" 
                                   placeholder="080XXXXXXXX" 
                                   required
                                   autofocus>
                            <div class="form-text ms-1">
                                <small>Use your registered mobile number</small>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="password" class="form-label fw-semibold small text-uppercase text-muted">
                                <i class="bi bi-lock me-1"></i> Password
                            </label>
                            <div class="input-group input-group-lg">
                                <input type="password" 
                                       class="form-control" 
                                       id="password" 
                                       name="password" 
                                       placeholder="Enter your password" 
                                       required>
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg fw-semibold">
                                <span class="loading-indicator me-2"></span>
                                <span id="loginText">Login</span>
                            </button>
                        </div>
                    </form>

                    <!-- Divider -->
                    <div class="d-flex align-items-center my-4">
                        <hr class="flex-grow-1">
                        <span class="text-muted small px-2">OR</span>
                        <hr class="flex-grow-1">
                    </div>

                    <!-- Help Section -->
                    <div class="text-center small text-muted">
                        <p class="mb-2">
                            <i class="bi bi-info-circle"></i> For password reset, contact your administrator
                        </p>
                        <p class="mb-0">
                            <i class="bi bi-shield-lock"></i> 
                            <strong>Tip:</strong> Use Ctrl+K for quick search after login
                        </p>
                    </div>
                </div>
            </div>

            <!-- Footer text -->
            <div class="text-center mt-3 text-muted small">
                <p>Â© 2026 NEOPHARM Pharmacy System</p>
            </div>
        </div>
    </div>
</div>

<style>
/* Additional login-specific styles */
#loginForm {
    transition: all 0.3s ease;
}

#loginForm.sending {
    opacity: 0.7;
    pointer-events: none;
}

.form-control:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
}

.input-group-text {
    background-color: #fff;
}

/* Loading state on button */
.btn-primary.loading .loading-indicator {
    display: inline-block !important;
}

.input-group:focus-within {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('loginForm');
    const loginText = document.getElementById('loginText');
    const toggleBtn = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('password');
    const loginBtn = form.querySelector('button[type="submit"]');

    // Password visibility toggle
    if (toggleBtn && passwordInput) {
        toggleBtn.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            const icon = toggleBtn.querySelector('i');
            icon.className = type === 'password' ? 'bi bi-eye' : 'bi bi-eye-slash';
        });
    }

    // Form submission animation
    if (form) {
        form.addEventListener('submit', function(e) {
            if (form.dataset.submitted) {
                e.preventDefault();
                return;
            }
            form.dataset.submitted = true;
            
            // Add loading state
            form.classList.add('sending');
            loginBtn.classList.add('loading');
            loginText.textContent = 'Authenticating...';
            
            // Show toast
            if (typeof NEOPHARM !== 'undefined') {
                NEOPHARM.showLoading('Verifying credentials...');
            }

            // Safety timeout to re-enable button if something goes wrong
            setTimeout(() => {
                if (form.dataset.submitted) {
                    form.dataset.submitted = false;
                    form.classList.remove('sending');
                    loginBtn.classList.remove('loading');
                    loginText.textContent = 'Login';
                }
            }, 10000);
        });
    }

    // Add focus animation
    const inputs = document.querySelectorAll('input.form-control');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.parentElement.classList.add('focused');
        });
        input.addEventListener('blur', function() {
            this.parentElement.classList.remove('focused');
        });
    });

    // Easter egg: Show welcome toast if returning from redirect
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('next') && typeof NEOPHARM !== 'undefined') {
        setTimeout(() => {
            NEOPHARM.toast('Please login to continue', 'info', 3000);
        }, 500);
    }
});
</script>
{% endblock %}



